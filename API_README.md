# Документация по API загрузки файлов

В этом документе описывается, как использовать API загрузки файлов для системы WhisperDB.

## Загрузка файлов с метаданными

### Конечная точка
```
POST /api/upload
```

### Формат запроса

Запрос должен быть в формате multipart/form-data со следующими полями:

1. `metadata` (обязательно): Строка JSON, содержащая метаданные узла
2. `files` (опционально): Один или несколько файлов, связанных с узлом

### Формат метаданных

Метаданные должны быть объектом JSON со следующими полями:

```json
{
  "title": "Название документа",
  "author": "Имя автора",
  "subject": "Предмет или категория",
  "description": "Необязательное описание",
  "course": 101,  // Необязательный ID курса
  "tags": "метка1, метка2, метка3"  // Необязательные метки через запятую
}
```

### Пример запроса (curl)

```bash
curl -X POST http://localhost:8080/api/upload \
  -F 'metadata={"title":"Лекционные заметки", "author":"Иван Иванов", "subject":"Информатика"}' \
  -F 'file1=@/путь/к/лекция1.pdf' \
  -F 'file2=@/путь/к/заметки.txt'
```

### Формат ответа

При успешном выполнении API вернет ответ в формате JSON:

```json
{
  "status": "success",
  "nodeId": 1,
  "files": [
    {
      "originalName": "лекция1.pdf",
      "storedPath": "2023/01/01/1672531200000_1234.pdf"
    },
    {
      "originalName": "заметки.txt",
      "storedPath": "2023/01/01/1672531200001_5678.txt"
    }
  ]
}
```

### Ошибки

В случае ошибки API вернет ответ в формате JSON с сообщением об ошибке:

```json
{
  "status": "error",
  "message": "Описание ошибки"
}
```

## Хранение файлов

Файлы сохраняются в директории `storage` со следующей структурой:
```
storage/
  ГОД/
    МЕСЯЦ/
      ДЕНЬ/
        ВРЕМЯ_СЛУЧАЙНОЕ_ЗНАЧЕНИЕ.расширение
```

Такая структура помогает в организации и предотвращает конфликты имен файлов.

## Примечания по безопасности

- API проверяет все входные данные
- Расширения файлов сохраняются, но имена файлов рандомизируются
- Установлен максимальный размер загружаемого файла (настраивается на сервере)
- Разрешены только POST-запросы к конечной точке загрузки
